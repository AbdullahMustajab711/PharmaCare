<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PharmaCare - Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    :root {
        --primary: #0f766e; --primary-light: #14b8a6; --primary-dark: #0d5e56;
        --secondary: #ccfbf1; --accent: #f59e0b; --danger: #ef4444; --wishlist: #e11d48;
        --bg-body: #f0fdfa; --bg-card: #ffffff; --text-main: #1e293b; --text-muted: #64748b;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        --radius: 12px;
    }
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    body { background:var(--bg-body); color:var(--text-main); overflow-x:hidden; }
    
    nav { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); color:var(--primary); position:sticky; top:0; z-index:100; box-shadow:var(--shadow-sm); border-bottom: 1px solid rgba(0,0,0,0.05); }
    .brand { display:flex; align-items:center; gap:10px; cursor:pointer; }
    .brand h1 { font-size:24px; font-weight:700; background: linear-gradient(90deg, var(--primary), var(--primary-light)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .nav-center { flex:1; margin:0 40px; }
    nav input { width:100%; padding:12px 20px; border-radius:50px; border:1px solid #e2e8f0; background:#f8fafc; outline:none; transition:0.3s; color:var(--text-main); }
    nav input:focus { background:#fff; border-color:var(--primary); box-shadow:0 0 0 3px rgba(20, 184, 166, 0.2); }
    .nav-actions { display:flex; align-items:center; gap:20px; }
    .nav-btn { cursor:pointer; font-size:20px; color:var(--text-muted); transition:0.3s; position:relative; background:none; border:none; }
    .nav-btn:hover { color:var(--primary); transform:translateY(-2px); }
    .cart-badge, .wishlist-badge { position:absolute; top:-5px; right:-8px; background:var(--danger); color:#fff; font-size:10px; font-weight:700; height:18px; min-width:18px; display:flex; align-items:center; justify-content:center; border-radius:50%; padding:0 4px; border:2px solid #fff; }
    .wishlist-badge { background: var(--wishlist); }
    .hamburger { display:block; font-size:24px; margin-left:auto; }
    .container { max-width:1300px; margin:0 auto; padding:20px; }
    .page-header { text-align: center; margin-bottom: 30px; }
    .page-header h2 { font-size: 2rem; color: var(--text-main); }
    .page-header p { color: var(--text-muted); }

    /* Filters */
    .filters-container { position: sticky; top: 85px; z-index: 90; margin-bottom: 20px; background: rgba(255,255,255,0.8); backdrop-filter: blur(8px); padding: 15px; border-radius: var(--radius); border: 1px solid rgba(0,0,0,0.05); box-shadow: var(--shadow-sm); display: flex; flex-wrap: wrap; gap: 10px; justify-content: space-between; align-items: center; }
    .filter-group { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .filter-label { font-size: 0.85rem; font-weight: 600; color: var(--text-muted); margin-right: 5px; }
    .filter-btn { padding: 8px 16px; border:1px solid #e2e8f0; border-radius:20px; background:#fff; cursor:pointer; font-size:0.85rem; font-weight:500; color:var(--text-muted); transition:all 0.2s ease; }
    .filter-btn:hover { border-color:var(--primary-light); color:var(--primary); }
    .filter-btn.active { background:var(--primary); color:#fff; border-color:var(--primary); box-shadow:0 2px 5px rgba(15, 118, 110, 0.3); }

    /* Grid */
    .medicine-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:30px; margin-top:10px; }
    .medicine-card { background:var(--bg-card); border-radius:16px; padding:20px; box-shadow:var(--shadow-sm); transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display:flex; flex-direction:column; align-items:center; text-align:center; position:relative; border:1px solid transparent; overflow: hidden; }
    .medicine-card.hidden-by-pagination { display: none; }
    .medicine-card.hidden-by-filter { display: none; }
    .medicine-card:hover { transform:translateY(-6px); box-shadow:var(--shadow-lg); border-color:var(--secondary); }
    .card-wishlist-btn { position: absolute; top: 15px; right: 15px; width: 35px; height: 35px; border-radius: 50%; background: #fff; border: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; z-index: 5; }
    .card-wishlist-btn svg { width: 20px; height: 20px; fill: none; stroke: var(--text-muted); stroke-width: 2; transition: 0.2s; }
    .card-wishlist-btn:hover { border-color: var(--wishlist); }
    .card-wishlist-btn:hover svg { stroke: var(--wishlist); }
    .card-wishlist-btn.active svg { fill: var(--wishlist); stroke: var(--wishlist); transform: scale(1.1); }
    .card-cat-badge { position:absolute; top:15px; left:15px; background:var(--secondary); color:var(--primary-dark); font-size:0.7rem; font-weight:700; padding:4px 10px; border-radius:12px; text-transform:uppercase; letter-spacing:0.5px; z-index: 4; }
    .offer-ribbon { position: absolute; top: 15px; right: -35px; background: #ef4444; color: white; padding: 5px 40px; transform: rotate(45deg); font-size: 0.8rem; font-weight: 700; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10; }
    .img-wrapper { width:140px; height:140px; margin: 20px 0; display:flex; align-items:center; justify-content:center; background: radial-gradient(circle, #f0fdfa 0%, #fff 70%); border-radius:50%; }
    .medicine-card img { width:100px; height:100px; object-fit:contain; mix-blend-mode: multiply; }
    .medicine-card h3 { font-size:1.1rem; margin-bottom:5px; color:var(--text-main); font-weight:600; }
    .medicine-card .price { font-size:1.25rem; color:var(--primary); font-weight:700; margin-bottom:15px; }
    .stock-tag { font-size:0.8rem; color:var(--text-muted); margin-bottom:15px; }
    .stock-tag.low { color:var(--accent); }
    .stock-tag.out { color:var(--danger); }
    .add-btn { margin-top:auto; width:100%; padding:12px; border:none; border-radius:10px; background:var(--primary); color:white; font-weight:600; cursor:pointer; transition:0.2s; display:flex; align-items:center; justify-content:center; gap:8px; }
    .add-btn:hover { background:var(--primary-dark); }
    .add-btn:disabled { background:#cbd5e1; cursor:not-allowed; }

    /* Pagination */
    .pagination-container { display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 40px; margin-bottom: 20px; flex-wrap: wrap; }
    .page-btn { padding: 8px 16px; border: 1px solid #e2e8f0; background: #fff; border-radius: 8px; cursor: pointer; transition: 0.2s; font-weight: 500; color: var(--text-main); min-width: 40px; }
    .page-btn:hover:not(:disabled) { background: var(--secondary); color: var(--primary-dark); }
    .page-btn:disabled { opacity: 0.4; cursor: not-allowed; background: #f1f5f9; }
    .page-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); transform: scale(1.05); }
    .page-info { font-size: 0.9rem; color: var(--text-muted); font-weight: 500; padding: 0 10px; }

    /* Side Nav */
    #sideNav { position: fixed; left: -300px; top: 0; width: 280px; height: 100%; background:#fff; color:var(--text-main); padding: 25px; transition: left 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index: 300; box-shadow: 5px 0 25px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
    #sideNav.open { left: 0; }
    #sideNav h2 { margin-bottom:30px; color:var(--primary); font-size:1.5rem; }
    .menu-link { display:block; margin:15px 0; padding:12px 15px; border-radius:12px; background:#f8fafc; color:var(--text-main); text-decoration:none; font-weight:500; transition:0.2s; border:1px solid transparent; }
    .menu-link:hover { background:var(--secondary); color:var(--primary-dark); }
    .close-nav { position:absolute; top:20px; right:20px; font-size:24px; cursor:pointer; color:var(--text-muted); }

    /* Modals & Sidebars */
    #profileModal, #contactModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(15, 118, 110, 0.4); backdrop-filter:blur(5px); z-index:400; justify-content:center; align-items:center; }
    .modal { background:#fff; padding:35px; border-radius:20px; width:100%; max-width:450px; box-shadow:0 20px 25px -5px rgba(0,0,0,0.1); animation: slideUp 0.3s ease-out; position: relative; }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal h2 { margin-bottom:25px; color:var(--primary); text-align:center; }
    .form-group { margin-bottom:15px; }
    .form-group label { display:block; font-size:0.9rem; font-weight:600; margin-bottom:5px; color:var(--text-muted); }
    .form-group input, .form-group textarea, .form-group select { width:100%; padding:12px; border-radius:8px; border:1px solid #cbd5e1; background:#f8fafc; outline:none; transition:0.3s; font-family: inherit; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color:var(--primary); background:#fff; }
    .modal-btn { width:100%; padding:12px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:600; margin-top:10px; cursor:pointer; transition: 0.2s; }
    .modal-btn:hover { background:var(--primary-dark); }
    .close-modal { position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:var(--text-muted); }
    .contact-modal-enhanced { max-width: 800px; width: 90%; padding: 0; overflow: hidden; display: flex; flex-direction: row; border-radius: 20px; background: white; }
    .contact-left { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; padding: 40px; width: 40%; display: flex; flex-direction: column; justify-content: center; position: relative; }
    .contact-left h3 { font-size: 1.8rem; margin-bottom: 10px; font-weight: 700; }
    .contact-left p { font-size: 0.95rem; opacity: 0.9; margin-bottom: 30px; line-height: 1.5; }
    .contact-info-item { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
    .contact-info-item svg { width: 20px; height: 20px; fill: white; opacity: 0.8; }
    .contact-right { padding: 40px; width: 60%; background: #fff; }
    .contact-right h2 { color: var(--primary); margin-bottom: 5px; }
    .contact-right .subtitle { color: var(--text-muted); font-size: 0.9rem; margin-bottom: 25px; display: block; }
    .sidebar-drawer { position:fixed; right:-400px; top:0; width:380px; height:100%; background:#fff; padding:0; transition:right 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index:200; box-shadow:-10px 0 30px rgba(0,0,0,0.1); display:flex; flex-direction:column; }
    .sidebar-drawer.open { right: 0; }
    .drawer-header { padding:25px; background:var(--bg-body); border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; }
    .drawer-header h2 { font-size:1.4rem; color:var(--primary); }
    #wishlistSidebar .drawer-header h2 { color: var(--wishlist); }
    .drawer-body { flex:1; overflow-y:auto; padding:20px; }
    .sidebar-item { display:flex; gap:15px; margin-bottom:15px; background:#fff; border:1px solid #f1f5f9; padding:10px; border-radius:12px; align-items:center; }
    .sidebar-item img { width:60px; height:60px; object-fit:contain; border-radius:8px; background:#f8fafc; }
    .item-details { flex:1; }
    .item-details h4 { font-size:0.95rem; margin-bottom:4px; }
    .item-details p { color:var(--primary); font-weight:600; font-size:0.9rem; }
    .remove-btn { background:#fee2e2; color:var(--danger); border:none; width:30px; height:30px; border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:0.2s; }
    .remove-btn:hover { background:var(--danger); color:white; }
    .add-cart-from-wishlist { margin-top: 5px; font-size: 0.8rem; color: var(--primary); background: none; border: none; cursor: pointer; text-decoration: underline; padding:0; }
    .drawer-footer { padding:25px; border-top:1px solid #e2e8f0; background:var(--bg-body); }
    .checkout-btn { width:100%; padding:14px; background:linear-gradient(90deg, var(--primary), var(--primary-light)); color:#fff; border:none; border-radius:10px; font-size:1rem; font-weight:600; cursor:pointer; box-shadow:0 4px 6px -1px rgba(15, 118, 110, 0.3); transition:0.3s; }
    .checkout-btn:hover { box-shadow:0 6px 10px -1px rgba(15, 118, 110, 0.4); transform:translateY(-1px); }
    #toast { position:fixed; bottom:30px; right:30px; background:var(--text-main); color:#fff; padding:15px 25px; border-radius:8px; display:none; z-index:500; box-shadow:0 10px 15px -3px rgba(0,0,0,0.1); animation: fadeIn 0.3s; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
    @media(max-width:900px){ nav { flex-wrap:wrap; padding:1rem; } .nav-center { order:3; width:100%; margin:10px 0 0 0; } .nav-actions { gap:15px; } .hamburger { display:block; margin-left:auto; } .sidebar-drawer { width:100%; right:-100%; } .contact-modal-enhanced { flex-direction: column; width: 95%; max-height: 90vh; overflow-y: auto; } .contact-left, .contact-right { width: 100%; } .contact-left { padding: 30px; } .contact-right { padding: 30px; } }
</style>
</head>
<body>
<nav>
    <div class="brand" onclick="window.location.href='/home'"><span style="font-size:28px;">üíä</span><h1>PharmaCare</h1></div>
    <div class="nav-center"><input type="text" placeholder="Search medicines..." id="searchInput"></div>
    <div class="nav-actions">
        <button class="nav-btn hamburger" onclick="toggleSideNav()">‚ò∞</button>
        <button class="nav-btn" onclick="toggleWishlistSidebar()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
            <span class="wishlist-badge" id="wishlistCount">{{ wishlist|length }}</span>
        </button>
        <button class="nav-btn" onclick="toggleCart()">üõí <span class="cart-badge" id="cartCount">{{ cart|length }}</span></button>
        <button class="nav-btn" onclick="openProfileModal()">üë§</button>
    </div>
</nav>
<div class="container">
    <div class="page-header"><h2>Our Medicines</h2><p>Find everything you need for your health and wellness.</p></div>
    <div class="filters-container">
        <div class="filter-group">
            <span class="filter-label">Category:</span>
            <button class="filter-btn active" onclick="filterCategory('all', event)">All</button>
            <button class="filter-btn" onclick="filterCategory('Pain Relief', event)">Pain Relief</button>
            <button class="filter-btn" onclick="filterCategory('Antibiotics', event)">Antibiotics</button>
            <button class="filter-btn" onclick="filterCategory('Vitamins', event)">Vitamins</button>
            <button class="filter-btn" onclick="filterCategory('Skin Care', event)">Skin Care</button>
        </div>
        <div class="filter-group">
            <span class="filter-label">Price:</span>
            <button class="filter-btn active" onclick="filterPrice('all', event)">Any</button>
            <button class="filter-btn" onclick="filterPrice('under10', event)">< $10</button>
            <button class="filter-btn" onclick="filterPrice('10to50', event)">$10 - $50</button>
            <button class="filter-btn" onclick="filterPrice('above50', event)">> $50</button>
        </div>
    </div>
    <div class="medicine-grid" id="medicineGrid">
        {% for med in medicines %}
        <div class="medicine-card" data-category="{{ med.category }}" data-price="{{ med.price }}">
            {% for deal in deals %}{% if deal.category == med.category or deal.category == 'All' %}<div class="offer-ribbon">{{ deal.discount }} OFF</div>{% endif %}{% endfor %}
            <button class="card-wishlist-btn {% for item in wishlist %}{% if item.id == med._id|string %}active{% endif %}{% endfor %}" onclick="toggleWishlist('{{ med._id }}', this)"><svg viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button>
            <span class="card-cat-badge">{{ med.category }}</span>
            <div class="img-wrapper"><img src="{{ med.image if med.image else 'https://picsum.photos/seed/' + med.name|string + '/200/200.jpg' }}" alt="{{ med.name }}"></div>
            <h3>{{ med.name }}</h3>
            <p class="price">${{ med.price }}</p>
            {% if med.quantity > 10 %}<p class="stock-tag">In Stock</p>{% elif med.quantity > 0 %}<p class="stock-tag low">Only {{ med.quantity }} left</p>{% else %}<p class="stock-tag out">Out of Stock</p>{% endif %}
            {% if med.quantity > 0 %}<button class="add-btn" onclick="addToCart('{{ med._id }}', this)"><span>Add to Cart</span> <span>+</span></button>{% else %}<button class="add-btn" disabled>Unavailable</button>{% endif %}
        </div>
        {% endfor %}
    </div>
    <div class="pagination-container" id="pagination"><button class="page-btn" id="prevBtn" onclick="changePage(-1)">Previous</button><div id="pageNumbers" style="display:contents;"></div><button class="page-btn" id="nextBtn" onclick="changePage(1)">Next</button></div>
</div>
<aside id="sideNav"><span class="close-nav" onclick="toggleSideNav()">‚úñ</span><h2>Menu</h2><a href="/home" class="menu-link">üè† Home Dashboard</a><a href="/shop" class="menu-link" style="background:var(--secondary); color:var(--primary-dark); border-color:var(--primary-light);">üíä Shop Medicines</a><a href="#" onclick="openProfileModal(); toggleSideNav()" class="menu-link">üë§ My Profile</a><a href="/user/receipts" class="menu-link">üßæ My Orders</a><a href="#" onclick="openContactModal(); toggleSideNav()" class="menu-link">üìß Contact Us</a><a href="/logout" class="menu-link" style="color:var(--danger); background:#fef2f2;">üö™ Logout</a></aside>
<div id="wishlistSidebar" class="sidebar-drawer"><div class="drawer-header"><h2>My Wishlist</h2><span class="close-nav" onclick="toggleWishlistSidebar()">‚úñ</span></div><div class="drawer-body" id="wishlistItems"></div><div class="drawer-footer"><button class="checkout-btn" onclick="moveAllToCart()" style="background: linear-gradient(90deg, var(--wishlist), #be123c);">Move All to Cart</button></div></div>
<div id="cartSidebar" class="sidebar-drawer"><div class="drawer-header"><h2>Your Cart</h2><span class="close-nav" onclick="toggleCart()">‚úñ</span></div><div class="drawer-body" id="cartItems">{% for item in cart %}<div class="sidebar-item"><img src="{{ item.image if item.image else 'https://picsum.photos/seed/' + item.name|string + '/100/100.jpg' }}" alt="{{ item.name }}"><div class="item-details"><h4>{{ item.name }}</h4><p>${{ item.price }}</p></div><button class="remove-btn" onclick="removeFromCart('{{ item.id }}')" title="Remove item">üóë</button></div>{% endfor %}{% if cart|length == 0 %}<div style="text-align:center; margin-top:50px; color:var(--text-muted);"><p>Your cart is empty.</p></div>{% endif %}</div><div class="drawer-footer">{% if cart|length > 0 %}<button class="checkout-btn" onclick="window.location.href='/checkout'">Proceed to Checkout</button>{% endif %}</div></div>
<div id="profileModal"><div class="modal"><span class="close-modal" onclick="closeProfileModal()">‚úñ</span><h2>Update Profile</h2><div class="form-group"><label>Full Name</label><input type="text" id="profileName" value="{{ user.name }}"></div><div class="form-group"><label>Email (Cannot be changed)</label><input type="email" id="profileEmail" value="{{ user.email }}" disabled style="background:#e2e8f0; color:#64748b;"></div><div class="form-group"><label>Phone Number</label><input type="text" id="profilePhone" value="{{ user.phone or '' }}" placeholder="Add phone number"></div><button class="modal-btn" onclick="updateProfile()">Save Changes</button></div></div>
<div id="contactModal"><div class="modal contact-modal-enhanced"><span class="close-modal" onclick="closeContactModal()" style="z-index: 10; color: white; right: 20px;">‚úñ</span><div class="contact-left"><h3>Get in touch</h3><p>We'd love to hear from you. Our team is ready to answer all your questions.</p><div class="contact-info-item"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg><span>support@pharmacare.com</span></div><div class="contact-info-item"><svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg><span>+1 (555) 123-4567</span></div><div class="contact-info-item"><svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg><span>123 Health Ave, NY</span></div></div><div class="contact-right"><h2>Contact Us</h2><span class="subtitle">Fill out the form and we'll get back to you.</span><div class="form-group"><label>Full Name</label><input type="text" id="contactName" value="{{ user.name }}"></div><div class="form-group"><label>Email Address</label><input type="email" id="contactEmail" value="{{ user.email }}"></div><div class="form-group"><label>Subject</label><select id="contactSubject" style="cursor:pointer;"><option value="General Inquiry">General Inquiry</option><option value="Order Support">Order Support</option><option value="Feedback">Feedback</option></select></div><div class="form-group"><label>Message</label><textarea id="contactMessage" rows="4" placeholder="How can we help you?"></textarea></div><button class="modal-btn" onclick="sendMessage()">Send Message üöÄ</button></div></div></div>
<div id="toast"></div>
<script>
let currentPage = 1; const itemsPerPage = 8;
document.addEventListener("DOMContentLoaded", () => { applyFilters(); });
function applyFilters() {
    const searchText = document.getElementById('searchInput').value.toLowerCase();
    const activeCatBtn = Array.from(document.querySelectorAll('.filter-btn')).find(b => b.classList.contains('active') && !b.innerText.includes('$'));
    const activeCategory = activeCatBtn ? activeCatBtn.innerText : 'All';
    const activePriceBtn = Array.from(document.querySelectorAll('.filter-btn')).find(b => b.classList.contains('active') && b.innerText.includes('$'));
    const activePriceText = activePriceBtn ? activePriceBtn.innerText : 'Any';
    const allCards = document.querySelectorAll('.medicine-card');
    allCards.forEach(card => {
        const name = card.querySelector('h3').innerText.toLowerCase();
        const category = card.getAttribute('data-category');
        const price = parseFloat(card.getAttribute('data-price'));
        let matchCat = activeCategory==='All' || category===activeCategory;
        let matchPrice = true;
        if(activePriceText.includes('< $10')){ matchPrice = price<10; } else if(activePriceText.includes('$10 - $50')){ matchPrice = price>=10 && price<=50; } else if(activePriceText.includes('> $50')){ matchPrice = price>50; }
        const isVisible = name.includes(searchText) && matchCat && matchPrice;
        if(isVisible) { card.classList.remove('hidden-by-filter'); } else { card.classList.add('hidden-by-filter'); }
    });
    currentPage = 1; renderPage();
}
function renderPage() {
    const visibleCards = document.querySelectorAll('.medicine-card:not(.hidden-by-filter)');
    const totalItems = visibleCards.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    visibleCards.forEach(card => card.classList.add('hidden-by-pagination'));
    const start = (currentPage - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    for(let i = start; i < end; i++) { if(visibleCards[i]) { visibleCards[i].classList.remove('hidden-by-pagination'); } }
    updatePaginationControls(totalPages);
}
function updatePaginationControls(totalPages) {
    const container = document.getElementById('pagination');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const numbersContainer = document.getElementById('pageNumbers');
    if(totalPages <= 1) { container.style.display = 'none'; return; } else { container.style.display = 'flex'; }
    prevBtn.disabled = currentPage === 1;
    nextBtn.disabled = currentPage === totalPages;
    numbersContainer.innerHTML = '';
    let startPage = Math.max(1, currentPage - 2);
    let endPage = Math.min(totalPages, startPage + 4);
    if (endPage - startPage < 4) { startPage = Math.max(1, endPage - 4); }
    for (let i = startPage; i <= endPage; i++) {
        const btn = document.createElement('button');
        btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        btn.innerText = i;
        btn.onclick = () => goToPage(i);
        numbersContainer.appendChild(btn);
    }
}
function changePage(direction) { currentPage += direction; renderPage(); document.getElementById('medicineGrid').scrollIntoView({ behavior: 'smooth', block: 'start' }); }
function goToPage(page) { currentPage = page; renderPage(); document.getElementById('medicineGrid').scrollIntoView({ behavior: 'smooth', block: 'start' }); }
document.getElementById('searchInput').addEventListener('input', applyFilters);
function filterCategory(category, event){ document.querySelectorAll('.filters-container .filter-btn').forEach(btn => { if(btn.textContent.includes('$')) return; btn.classList.remove('active'); }); event.target.classList.add('active'); applyFilters(); }
function filterPrice(priceRange, event){ document.querySelectorAll('.filters-container .filter-btn').forEach(btn => { if(btn.textContent.includes('$')) btn.classList.remove('active'); }); event.target.classList.add('active'); applyFilters(); }
function toggleSideNav() { document.getElementById('sideNav').classList.toggle('open'); }
function toggleCart() { document.getElementById('cartSidebar').classList.toggle('open'); }
function toggleWishlistSidebar() { document.getElementById('wishlistSidebar').classList.toggle('open'); }
function openProfileModal() { document.getElementById('profileModal').style.display = 'flex'; }
function closeProfileModal() { document.getElementById('profileModal').style.display = 'none'; }
function openContactModal() { document.getElementById('contactModal').style.display = 'flex'; }
function closeContactModal() { document.getElementById('contactModal').style.display = 'none'; }
function showToast(message){ const toast = document.getElementById('toast'); toast.textContent = message; toast.style.display = 'block'; setTimeout(()=>{ toast.style.opacity = '0'; setTimeout(()=>{ toast.style.display='none'; toast.style.opacity='1'; },300); },3000); }
function updateProfile() { const name = document.getElementById('profileName').value; const phone = document.getElementById('profilePhone').value; if(!name) { showToast("Name is required"); return; } fetch("/user/update_profile", { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({name, phone}) }).then(res => res.json()).then(data => { showToast(data.message); if(data.success) { closeProfileModal(); setTimeout(() => location.reload(), 1000); } }); }
function sendMessage() { const name = document.getElementById('contactName').value; const email = document.getElementById('contactEmail').value; const subject = document.getElementById('contactSubject').value; const message = document.getElementById('contactMessage').value; if(!message) { showToast("Please write a message"); return; } fetch("/contact", { method:"POST", headers:{"Content-Type":"application/json"}, body: JSON.stringify({name, email, subject, message}) }).then(res => res.json()).then(data => { showToast(data.message); if(data.success) { closeContactModal(); document.getElementById('contactMessage').value = ""; } }); }
function toggleWishlist(med_id, btnElement) {
    const isActive = btnElement.classList.contains('active');
    if (isActive) {
        btnElement.classList.remove('active');
        fetch("/user/remove_from_wishlist", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({med_id}) }).then(res => res.json()).then(data => { updateWishlistUI(data.wishlist); });
    } else {
        btnElement.classList.add('active');
        fetch("/user/add_to_wishlist", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({med_id}) }).then(res => res.json()).then(data => { updateWishlistUI(data.wishlist); showToast("Added to Wishlist ‚ù§Ô∏è"); }).catch(() => { btnElement.classList.remove('active'); });
    }
}
function updateWishlistUI(wishlistData){ const wishlistContainer = document.getElementById('wishlistItems'); const wishlistCount = document.getElementById('wishlistCount'); wishlistContainer.innerHTML = ""; wishlistCount.textContent = wishlistData.length; if(wishlistData.length === 0) wishlistContainer.innerHTML = `<div style="text-align:center; margin-top:50px; color:var(--text-muted);"><p>Your wishlist is empty.</p></div>`; else { wishlistData.forEach(item=>{ const div = document.createElement('div'); div.className = 'sidebar-item'; div.innerHTML = `<img src="${item.image || 'https://picsum.photos/seed/' + item.name + '/100/100.jpg'}" alt="${item.name}"><div class="item-details"><h4>${item.name}</h4><p>$${item.price}</p><button class="add-cart-from-wishlist" onclick="moveToCart('${item.id}')">Add to Cart</button></div><button class="remove-btn" onclick="removeFromWishlist('${item.id}')" title="Remove item">üóë</button>`; wishlistContainer.appendChild(div); }); } }
function removeFromWishlist(med_id) { const heartBtn = document.querySelector(`.card-wishlist-btn[onclick*="${med_id}"]`); if(heartBtn) heartBtn.classList.remove('active'); fetch("/user/remove_from_wishlist", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({med_id}) }).then(res => res.json()).then(data => { updateWishlistUI(data.wishlist); }); }
function moveToCart(med_id) { const cardBtn = document.querySelector(`.add-btn[onclick*="${med_id}"]`); if(cardBtn) { addToCart(med_id, cardBtn); } else { addToCartDirect(med_id); } }
function addToCartDirect(med_id) { fetch("/user/add_to_cart", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({med_id}) }).then(res => res.json()).then(data => { if(data.cart){ updateCartUI(data.cart); showToast("Added to cart!"); removeFromWishlist(med_id); } else { showToast(data.message); } }); }
function moveAllToCart() { const wishlistItems = document.querySelectorAll('#wishlistItems .sidebar-item'); if(wishlistItems.length === 0) return; let processed = 0; wishlistItems.forEach(item => { const addBtn = item.querySelector('.add-cart-from-wishlist'); if(addBtn) addBtn.click(); processed++; }); if(processed > 0) showToast("Processing items..."); }
function addToCart(med_id, btn){ const originalContent = btn.innerHTML; btn.innerHTML = "Adding..."; btn.disabled = true; fetch("/user/add_to_cart", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({med_id}) }).then(res => res.json()).then(data => { if(data.cart){ updateCartUI(data.cart); showToast(`Added to cart!`); btn.innerHTML = "Added ‚úî"; btn.style.background = "var(--primary)"; setTimeout(()=>{ btn.innerHTML = originalContent; btn.disabled = false; },1500); } else { showToast(data.message); btn.innerHTML = originalContent; btn.disabled = false; } }).catch(err => { showToast("Error adding item"); btn.innerHTML = originalContent; btn.disabled = false; }); }
function removeFromCart(med_id){ fetch("/user/remove_from_cart", { method: "POST", headers: {"Content-Type": "application/json"}, body: JSON.stringify({med_id}) }).then(res => res.json()).then(data => { if(data.cart){ updateCartUI(data.cart); showToast("Removed from cart"); } else { showToast(data.message); } }); }
function updateCartUI(cartData){ const cartItems = document.getElementById('cartItems'); const cartCount = document.getElementById('cartCount'); cartItems.innerHTML = ""; if(cartData.length === 0){ cartItems.innerHTML = `<div style="text-align:center; margin-top:50px; color:var(--text-muted);"><p>Your cart is empty.</p></div>`; document.querySelector('.checkout-btn')?.remove(); } else { cartData.forEach(item=>{ const div = document.createElement('div'); div.className = 'sidebar-item'; div.innerHTML = `<img src="${item.image || 'https://picsum.photos/seed/' + item.name + '/100/100.jpg'}" alt="${item.name}"><div class="item-details"><h4>${item.name}</h4><p>$${item.price}</p></div><button class="remove-btn" onclick="removeFromCart('${item.id}')" title="Remove item">üóë</button>`; cartItems.appendChild(div); }); let checkoutBtn = document.querySelector('.checkout-btn'); if(!checkoutBtn){ checkoutBtn = document.createElement('button'); checkoutBtn.className='checkout-btn'; checkoutBtn.textContent='Proceed to Checkout'; checkoutBtn.onclick=()=>window.location.href='/checkout'; document.querySelector('#cartSidebar .drawer-footer').appendChild(checkoutBtn); } } cartCount.textContent = cartData.length; }
window.onclick = function(event) { const modal = document.getElementById('profileModal'); const contactModal = document.getElementById('contactModal'); const sideNav = document.getElementById('sideNav'); const hamburger = document.querySelector('.hamburger'); if (event.target == modal) closeProfileModal(); if (event.target == contactModal) closeContactModal(); if (sideNav.classList.contains('open') && !sideNav.contains(event.target) && !hamburger.contains(event.target)) sideNav.classList.remove('open'); }
</script>
</body>
</html>